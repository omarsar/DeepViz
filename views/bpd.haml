!!! 5
%html
%head
  %title DeepViz - Understanding Depression

  / Get the javascript to work
  %script{:src => "https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"}

  / Header libraries for D3
  %script{:src => "http://d3js.org/d3.v3.min.js"}
  %script{:src => "/javascripts/d3.layout.cloud.js"}

  / Latest compiled and minified CSS
  %link{:crossorigin => "anonymous", :href => "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css", :integrity => "sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7", :rel => "stylesheet"}
  / Optional theme
  %link{:crossorigin => "anonymous", :href => "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css", :integrity => "sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r", :rel => "stylesheet"}
  / Latest compiled and minified JavaScript
  %script{:crossorigin => "anonymous", :integrity => "sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS", :src => "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"}

  / Custom Fonts
  %link{:href => "https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css", :rel => "stylesheet", :type => "text/css"}

%body
  .row{:style => "margin-left: 20px;margin-right:20px"}
    %br
    .col-md-12
      = "The following is the report for user @#{@user_profile['name']}"
    %br
    %br    
    / Left Box -> Prediction Information
    .col-md-6

      .col-md-4
        .panel.panel-default
          .panel-heading
            %i.fa.fa-hand-o-right
            Age Prediction
          .panel-body
            = "#{@user_report['age']}"

      .col-md-4
        .panel.panel-default
          .panel-heading
            %i.fa.fa-hand-o-right
            Gender Prediction
          .panel-body
            = "#{@user_report['gender']}"

      .col-md-4
        .panel.panel-default
          .panel-heading
            %i.fa.fa-hand-o-right
            Mentioning Frequency
          .panel-body
            = "#{@user_report['mentioning_frequency']}"

    / Right Box -> Visualizations
    .col-md-6
      /.text-center
      .panel.panel-default
        .panel-heading
          %i.fa.fa-hand-o-right
          Word cloud generated by tweets
        .panel-body
          #wordcloud{:style => "width:100%"}
      / to be moved to React but for now keep using standard javascript
      :javascript
        var word_data = #{@word_cloud_text.to_json}

        var color = d3.scale.linear()
          .domain([0,1,2,3,4,5,6,10,15,20,100])
          .range(["#ddd", "#ccc", "#bbb", "#aaa", "#999", "#888", "#777", "#666", "#555", "#444", "#333", "#222"].reverse());

        /* Readme word Cloud ************************************************/
        d3.layout.cloud().size([800, 300]) //width, height
          .words(word_data)
          .rotate(0)
          .fontSize(function(d) { return d.size*4; })
          .on("end", draw)
          .start();
        
        function draw(words) {
          d3.select("#wordcloud").append("svg")
            .attr("width", 850)
            .attr("height", 350)
            .attr("class", "wordcloud")
            .append("g")
            // without the transform, words words would get cutoff to the left and top, they would
            // appear outside of the SVG area
            //modify the postition of the cloud on the canvas 
            .attr("transform", "translate(320,200)")
            .selectAll("text")
            .data(words)
            .enter().append("text")
            .style("font-size", function(d) { return d.size + "px"; })
            .style("fill", function(d, i) { return color(i); })
            .attr("transform", function(d) {
              return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
          })
          .text(function(d) { return d.text; });
        }

        
